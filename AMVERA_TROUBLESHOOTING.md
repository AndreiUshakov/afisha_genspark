# Amvera Deployment - Troubleshooting Quick Guide

–ë—ã—Å—Ç—Ä—ã–µ —Ä–µ—à–µ–Ω–∏—è —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ Amvera.

## üî¥ Build Failed

### –û—à–∏–±–∫–∞: "Out of memory" / "JavaScript heap out of memory"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ RAM –¥–ª—è —Å–±–æ—Ä–∫–∏ Next.js

**–†–µ—à–µ–Ω–∏–µ 1:** –£–≤–µ–ª–∏—á—å—Ç–µ RAM –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Amvera –¥–æ 1-2GB

**–†–µ—à–µ–Ω–∏–µ 2:** –î–æ–±–∞–≤—å—Ç–µ –≤ `amvera.yml`:
```yaml
build:
  env:
    NODE_ENV: production
    NODE_OPTIONS: "--max-old-space-size=4096"
```

---

### –û—à–∏–±–∫–∞: "npm ERR! code ELIFECYCLE"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–±–æ—Ä–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ: `npm run build`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Amvera –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `package.json`

---

### –û—à–∏–±–∫–∞: "Module not found: Can't resolve..."

**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
npm install –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π-–ø–∞–∫–µ—Ç --save
git add package.json package-lock.json
git commit -m "fix: add missing dependency"
git push origin main
```

---

## üî¥ Deploy –£—Å–ø–µ—à–Ω—ã–π, –Ω–æ –°–∞–π—Ç –Ω–µ –†–∞–±–æ—Ç–∞–µ—Ç

### –û—à–∏–±–∫–∞ 502 / Bad Gateway

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –∏–ª–∏ –∫—Ä–∞—à–∏—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Amvera (–≤–∫–ª–∞–¥–∫–∞ "Logs")
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 3000 —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ `amvera.yml`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `npm start` —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ

---

### –û—à–∏–±–∫–∞ 404 –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** Next.js –Ω–µ —Å–æ–±—Ä–∞–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `.next` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `npm run build` –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —É—Å–ø–µ—à–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `next.config.ts` –Ω–∞ –æ—à–∏–±–∫–∏

---

## üî¥ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

### –û—à–∏–±–∫–∞: "hostname is not configured under images"

**–ü—Ä–∏—á–∏–Ω–∞:** Next.js Image –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `next.config.ts`:
```typescript
export default {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
    ],
  },
};
```

---

## üî¥ –ú–µ–¥–ª–µ–Ω–Ω—ã–π Build

### Build –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª–µ–µ 10 –º–∏–Ω—É—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–µ–¥–ª–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–ª–∏ –±–æ–ª—å—à–∞—è —Å–±–æ—Ä–∫–∞

**–†–µ—à–µ–Ω–∏–µ 1:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npm ci` –≤–º–µ—Å—Ç–æ `npm install` (—É–∂–µ –≤ `amvera.yml`)

**–†–µ—à–µ–Ω–∏–µ 2:** –í–∫–ª—é—á–∏—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `amvera.yml`:
```yaml
run:
  persistStore: /app/.next
```

**–†–µ—à–µ–Ω–∏–µ 3:** –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
# –£–¥–∞–ª–∏—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã
npm prune

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
npm dedupe
```

---

## üî¥ Environment Variables

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Amvera –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Amvera (Settings ‚Üí Environment Variables)
2. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å `NEXT_PUBLIC_`:
   ```
   NEXT_PUBLIC_API_URL=https://api.example.com
   ```
3. –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–∞–π—Ç–µ redeploy

---

## üî¥ Hot Fixes

### –ù—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é

**–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Amvera:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Deployments
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–ø–ª–æ–π
3. –ù–∞–∂–º–∏—Ç–µ "Rollback"

**–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Git:**
```bash
git revert HEAD
git push origin main
```

---

## üî¥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ
ls -la | grep -E "amvera.yml|.nvmrc|package.json"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ amvera.yml
cat amvera.yml

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Node.js
cat .nvmrc

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ build —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
npm run build

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ start —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
npm run start
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ `amvera.yml` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ `.nvmrc` —Å–æ–¥–µ—Ä–∂–∏—Ç `20`
- ‚úÖ `npm run build` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ `npm run start` –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 3000

---

## üî¥ –õ–æ–≥–∏ –∏ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:

1. **Build –ª–æ–≥–∏:** 
   - Amvera Dashboard ‚Üí Deployments ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ø–ª–æ–π ‚Üí Build Logs

2. **Runtime –ª–æ–≥–∏:**
   - Amvera Dashboard ‚Üí Logs ‚Üí Real-time logs

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤:**
   ```
   # –í –ø–æ–∏—Å–∫–µ Amvera Logs
   error
   warning
   failed
   ```

---

## üî¥ –ß–∞—Å—Ç—ã–µ –û—à–∏–±–∫–∏ TypeScript

### –û—à–∏–±–∫–∞: "Type error: ..."

**–ü—Ä–∏—á–∏–Ω–∞:** TypeScript –æ—à–∏–±–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–±–æ—Ä–∫—É

**–†–µ—à–µ–Ω–∏–µ 1:** –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ
```bash
npm run build
# –ò—Å–ø—Ä–∞–≤—å—Ç–µ –≤—Å–µ –æ—à–∏–±–∫–∏
```

**–†–µ—à–µ–Ω–∏–µ 2 (–≤—Ä–µ–º–µ–Ω–Ω—ã–π workaround):** –û—Ç–∫–ª—é—á–∏—Ç–µ —Å—Ç—Ä–æ–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `next.config.ts`:
```typescript
export default {
  typescript: {
    ignoreBuildErrors: true, // –ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –¥–ª—è production
  },
};
```

---

## üî¥ –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ü–æ–º–æ—â–∏

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Amvera:** https://docs.amvera.io
- **Next.js Docs:** https://nextjs.org/docs
- **GitHub Issues:** https://github.com/AndreiUshakov/afisha_genspark/issues

---

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–ø–ª–æ—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Amvera CLI)
amvera deploy status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
amvera logs

# –°–ø–∏—Å–æ–∫ –¥–µ–ø–ª–æ–µ–≤
amvera deploy list

# Rollback
amvera deploy rollback <deployment-id>
```

---

## ‚úÖ Successful Deploy Checklist

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–±—ã—Ç–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (`/events`)
- [ ] –°–æ–æ–±—â–µ—Å—Ç–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (`/communities`)
- [ ] –≠–∫—Å–ø–µ—Ä—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (`/experts`)
- [ ] –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è
- [ ] –§–æ—Ä–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Mobile –≤–µ—Ä—Å–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] SEO –º–µ—Ç–∞-—Ç–µ–≥–∏ –Ω–∞ –º–µ—Å—Ç–µ

---

**üí° –°–æ–≤–µ—Ç:** –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ `npm run build` –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ push –≤ main!
