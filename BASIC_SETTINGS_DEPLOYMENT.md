# Инструкция по развертыванию страницы базовых настроек

## Что было реализовано

Создана страница `/dashboard/community/[slug]/settings/basic` для редактирования основных настроек сообщества со следующими полями:

### Основная информация
- Название сообщества
- Категория
- Краткое описание (до 200 символов)

### Фильтры и аудитория
- **Для кого** - социальная аудитория (множественный выбор)
- **Я хочу** - желания/цели (множественный выбор)
- **Возрастные категории** - возрастные группы (множественный выбор)

### Контактная информация
- Email для связи (обязательное поле)
- Телефон (опциональное поле)

### Социальные сети
- VK
- Telegram
- MAX (новое поле)
- Сайт

## Шаги по развертыванию

### 1. Применить миграцию базы данных

Необходимо применить миграцию для добавления полей `contact_email`, `contact_phone` и `age_categories` в таблицу `communities`.

**Вариант А: Через Supabase CLI (рекомендуется)**
```bash
# Убедитесь, что вы в корневой директории проекта
supabase db push
```

**Вариант Б: Через Supabase Dashboard**
1. Откройте Supabase Dashboard
2. Перейдите в SQL Editor
3. Скопируйте содержимое файла `supabase/migrations/20231215_add_contact_fields_to_communities.sql`
4. Выполните SQL

### 2. Проверить изменения

После применения миграции проверьте, что:
- В таблице `communities` появились новые поля: `contact_email`, `contact_phone`, `age_categories`
- Старое поле `age_category` все еще присутствует (для обратной совместимости)

### 3. Развернуть код

Изменения уже включены в кодовую базу:

**Новые файлы:**
- `app/dashboard/community/[slug]/settings/basic/page.tsx` - главная страница
- `app/dashboard/community/[slug]/settings/basic/actions.ts` - server actions
- `app/dashboard/community/[slug]/settings/basic/components/BasicSettingsForm.tsx` - форма
- `supabase/migrations/20231215_add_contact_fields_to_communities.sql` - миграция БД

**Обновленные файлы:**
- `types/community.ts` - добавлено поле `max` в `SocialLinks`
- `app/dashboard/create-community/components/Step1BasicInfo.tsx` - добавлено поле MAX

### 4. Перезапустить приложение

```bash
# Для локальной разработки
npm run dev

# Для продакшена
npm run build
npm start
```

## Проверка функциональности

1. Войдите в систему как владелец сообщества
2. Перейдите в `/dashboard/community/[ваш-slug]/settings`
3. Нажмите на карточку "Основная информация"
4. Проверьте, что все поля отображаются и редактируются
5. Сохраните изменения и убедитесь, что данные сохранились

## Возможные проблемы

### Ошибка при применении миграции
- **Причина**: Поле уже существует
- **Решение**: Миграция использует `IF NOT EXISTS`, поэтому это безопасно

### Данные не сохраняются
- **Причина**: RLS политики не позволяют изменения
- **Решение**: Убедитесь, что вы авторизованы как владелец сообщества

### Поля MAX не отображаются в форме создания
- **Причина**: Кеш браузера
- **Решение**: Очистите кеш и перезагрузите страницу

## Дополнительная информация

- Подробное описание: [`app/dashboard/community/[slug]/settings/basic/README.md`](app/dashboard/community/[slug]/settings/basic/README.md)
- Файл миграции: [`supabase/migrations/20231215_add_contact_fields_to_communities.sql`](supabase/migrations/20231215_add_contact_fields_to_communities.sql)

## Обратная совместимость

- Старое поле `age_category` сохранено для обратной совместимости
- При наличии данных в `age_category`, они автоматически мигрируются в `age_categories`
- Форма создания сообщества обновлена для поддержки поля MAX