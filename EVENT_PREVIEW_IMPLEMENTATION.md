# Реализация предпросмотра страницы мероприятия

## Описание

Добавлена функциональность предпросмотра страницы мероприятия, доступная владельцам сообществ и администраторам для просмотра событий в любом статусе.

## Реализованные компоненты

### 1. Публичная страница предпросмотра события
**Файл:** [`app/events/[id]/page.tsx`](app/events/[id]/page.tsx:1)

**Функциональность:**
- Отображение полной информации о мероприятии
- Рендеринг блоков контента (heading, text, image, carousel)
- Проверка прав доступа:
  - Опубликованные события доступны всем
  - Черновики доступны только владельцу сообщества и администраторам
- Баннер предупреждения для владельца при просмотре черновика
- Адаптивный дизайн с поддержкой темной темы

**Основные секции:**
- Обложка с основной информацией
- Блоки контента события
- Детали мероприятия (дата, место, цена, вместимость)
- Информация об организаторе
- Теги

### 2. Ссылка на предпросмотр в "Информационной карточке события"
**Файл:** [`app/dashboard/community/[slug]/events/[id]/edit/content/page.tsx`](app/dashboard/community/[slug]/events/[id]/edit/content/page.tsx:76)

**Изменения:**
- Добавлена информационная карточка с основными данными события
- Кнопка "Предпросмотр страницы" открывает событие в новой вкладке
- Отображение текущего статуса публикации

### 3. Плитка-ссылка на странице управления мероприятием
**Файл:** [`app/dashboard/community/[slug]/events/[id]/edit/page.tsx`](app/dashboard/community/[slug]/events/[id]/edit/page.tsx:160)

**Изменения:**
- Добавлена новая плитка "Предпросмотр страницы"
- Иконка глаза для визуальной идентификации
- Открывается в новой вкладке

### 4. Кнопка предпросмотра в таблице мероприятий
**Файл:** [`app/dashboard/community/[slug]/events/components/EventsTable.tsx`](app/dashboard/community/[slug]/events/components/EventsTable.tsx:206)

**Изменения:**
- Добавлена иконка предпросмотра между кнопками "Избранное" и "Редактировать"
- Tooltip "Предпросмотр" при наведении
- Открывается в новой вкладке

## Логика доступа

### Опубликованные события (is_published = true)
- ✅ Доступны всем пользователям
- ✅ Доступны без авторизации

### Черновики (is_published = false)
- ✅ Доступны владельцу сообщества (`community.owner_id === user.id`)
- ✅ Доступны администраторам (`user.user_metadata?.role === 'admin'`)
- ❌ Недоступны остальным пользователям (404)

### Удаленные события (deleted_at !== null)
- ❌ Недоступны всем (404)

## Маршруты

### Публичный предпросмотр
```
/events/[id]
```
Где `[id]` - UUID мероприятия

### Административные страницы с ссылками
```
/dashboard/community/[slug]/events                    - Таблица мероприятий
/dashboard/community/[slug]/events/[id]/edit          - Управление мероприятием
/dashboard/community/[slug]/events/[id]/edit/content  - Страница контента события
```

## UI/UX особенности

### Баннер для владельца
При просмотре черновика владельцем отображается желтый баннер:
- Текст: "Режим предпросмотра - Событие не опубликовано"
- Кнопка возврата к редактированию

### Визуальные элементы
- **Обложка:** Изображение события или градиент по умолчанию
- **Badges:** Категория, "Бесплатно", возрастное ограничение
- **Иконки:** Дата, место, цена, вместимость
- **Блоки контента:** Полная поддержка всех типов блоков

### Адаптивность
- Мобильные устройства: 1 колонка
- Планшеты: 1 колонка
- Десктоп: 2 колонки (контент + боковая панель)

## Типы блоков контента

1. **heading** - Заголовок
2. **text** - Текстовый блок с поддержкой переносов строк
3. **image** - Одиночное изображение с подписью
4. **carousel** - Галерея изображений (сетка 1-3 колонок)

## Интеграция с существующим функционалом

### Связь с базой данных Supabase
- Таблица `events` - основная информация
- Таблица `event_content_blocks` - блоки контента
- Таблица `categories` - категории событий
- Таблица `communities` - информация о сообществах

### RLS политики
Страница использует server-side Supabase client, который корректно применяет политики безопасности на уровне строк (RLS).

## Тестирование

### Тест-кейсы

1. **Владелец просматривает черновик**
   - ✅ Должен видеть баннер предупреждения
   - ✅ Должен видеть все блоки контента
   - ✅ Должна быть кнопка возврата к редактированию

2. **Владелец просматривает опубликованное событие**
   - ✅ Баннер не отображается
   - ✅ Все данные видны корректно

3. **Посторонний пользователь пытается просмотреть черновик**
   - ✅ Должна отображаться страница 404

4. **Посторонний пользователь просматривает опубликованное событие**
   - ✅ Должен видеть все публичные данные
   - ❌ Не должен видеть баннер предупреждения

5. **Администратор просматривает любое событие**
   - ✅ Должен иметь доступ ко всем событиям
   - ✅ Должен видеть баннер для черновиков

## Будущие улучшения

1. **Социальные функции**
   - Кнопка "Добавить в избранное"
   - Кнопка "Зарегистрироваться"
   - Кнопка "Поделиться"

2. **SEO оптимизация**
   - Метатеги Open Graph
   - Structured data (JSON-LD)
   - Sitemap интеграция

3. **Аналитика**
   - Отслеживание просмотров
   - Счетчик просмотров в реальном времени

4. **Дополнительные блоки**
   - Видео блок
   - Блок с расписанием
   - Блок с FAQ
   - Блок с командой спикеров

## Зависимости

- Next.js 15+ (async params)
- React 18+
- Tailwind CSS
- Supabase Client
- next/image для оптимизации изображений
- next/link для навигации

## Файлы, затронутые изменениями

1. `app/events/[id]/page.tsx` - **создан**
2. `app/dashboard/community/[slug]/events/[id]/edit/content/page.tsx` - **изменен**
3. `app/dashboard/community/[slug]/events/[id]/edit/page.tsx` - **изменен**
4. `app/dashboard/community/[slug]/events/components/EventsTable.tsx` - **изменен**
5. `EVENT_PREVIEW_IMPLEMENTATION.md` - **создан**