# üì∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–•—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π](#—Ö—Ä–∞–Ω–µ–Ω–∏–µ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
5. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–∏-—Å–∂–∞—Ç–∏–µ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
6. [UI/UX –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#uiux-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
7. [API –∏ Server Actions](#api-–∏-server-actions)
8. [Workflow –∑–∞–≥—Ä—É–∑–∫–∏](#workflow-–∑–∞–≥—Ä—É–∑–∫–∏)
9. [Best Practices](#best-practices)
10. [–î–∏–∞–≥—Ä–∞–º–º—ã](#–¥–∏–∞–≥—Ä–∞–º–º—ã)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–ú–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤ –∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è:
- –ó–∞–≥—Ä—É–∂–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –í—ã–±–∏—Ä–∞—Ç—å —Ñ–æ—Ç–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–æ—Ç–æ –≤ –≤–∏–¥–µ –∫–∞—Ä—É—Å–µ–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤ –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **Drag & Drop –∑–∞–≥—Ä—É–∑–∫–∞** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å  
‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –¥–æ 10 —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ** - 3 —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
‚úÖ **–£–º–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–≤ >3MB  
‚úÖ **–ì–∞–ª–æ—á–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏** - –≤—ã–±–æ—Ä —Ñ–æ—Ç–æ –¥–ª—è –ø–æ–∫–∞–∑–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ  
‚úÖ **–ö–∞—Ä—É—Å–µ–ª—å** - –∫—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö  

---

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
   - –í–ª–∞–¥–µ–ª—å—Ü—ã —Å–æ–æ–±—â–µ—Å—Ç–≤ –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π —Å–≤–æ–µ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
   - –≠–∫—Å–ø–µ—Ä—Ç—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–µ–π –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π

2. **–ó–∞–≥—Ä—É–∑–∫–∞:**
   - Drag & Drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–¥–æ 10 —Ñ–∞–π–ª–æ–≤)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: JPG, PNG, WebP
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 10MB

3. **–•—Ä–∞–Ω–µ–Ω–∏–µ:**
   - –õ–∏–º–∏—Ç: 200 —Ñ–æ—Ç–æ –Ω–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ/—ç–∫—Å–ø–µ—Ä—Ç–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ 3 —Ä–∞–∑–º–µ—Ä–æ–≤
   - –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–≤ >3MB

4. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è:**
   - –í—ã–±–æ—Ä —Ñ–æ—Ç–æ –≥–∞–ª–æ—á–∫–∞–º–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –≤–∏–¥–µ –∫–∞—Ä—É—Å–µ–ª–∏
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: <5 —Å–µ–∫—É–Ω–¥
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–∂–∞—Ç–∏–µ: <10 —Å–µ–∫—É–Ω–¥
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—É—Å–µ–ª–∏: <2 —Å–µ–∫—É–Ω–¥—ã

2. **–†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   - **Large:** 1920px (–¥–ª–∏–Ω–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞) - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
   - **Medium:** 800px (–¥–ª–∏–Ω–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞) - –¥–ª—è –∫–∞—Ä—É—Å–µ–ª–∏
   - **Thumbnail:** 300px (–¥–ª–∏–Ω–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞) - –¥–ª—è –ø—Ä–µ–≤—å—é

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

---

## üóÑÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: media_library

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∏
create table media_library (
  id uuid default uuid_generate_v4() primary key,
  
  -- –í–ª–∞–¥–µ–ª–µ—Ü (—Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏–ª–∏ —ç–∫—Å–ø–µ—Ä—Ç)
  owner_type text check (owner_type in ('community', 'expert')) not null,
  owner_id uuid not null,
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  title text,
  description text,
  alt_text text,
  
  -- URLs –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
  url_large text not null,      -- 1920px
  url_medium text not null,     -- 800px
  url_thumbnail text not null,  -- 300px
  
  -- –ü—É—Ç–∏ –≤ Storage (–¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è)
  storage_path_large text not null,
  storage_path_medium text not null,
  storage_path_thumbnail text not null,
  
  -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
  original_filename text not null,
  file_size_bytes bigint not null,  -- —Ä–∞–∑–º–µ—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
  mime_type text not null,
  width int,
  height int,
  
  -- –ü—É–±–ª–∏–∫–∞—Ü–∏—è
  is_published boolean default false,  -- –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  display_order int default 0,        -- –ø–æ—Ä—è–¥–æ–∫ –≤ –∫–∞—Ä—É—Å–µ–ª–∏
  
  -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
  uploaded_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null,
  
  -- –ò–Ω–¥–µ–∫—Å—ã
  constraint media_library_owner_check check (
    (owner_type = 'community' and owner_id in (select id from communities)) or
    (owner_type = 'expert' and owner_id in (select id from experts))
  )
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
create index media_library_owner_idx on media_library(owner_type, owner_id);
create index media_library_published_idx on media_library(owner_type, owner_id, is_published);
create index media_library_display_order_idx on media_library(owner_type, owner_id, display_order);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
create trigger update_media_library_updated_at 
  before update on media_library
  for each row 
  execute procedure update_updated_at_column();

-- Row Level Security
alter table media_library enable row level security;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ
create policy "Published media is viewable by everyone"
  on media_library for select
  using (is_published = true);

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –≤–ª–∞–¥–µ–ª—å—Ü—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –º–µ–¥–∏–∞
create policy "Owners can manage their media"
  on media_library for all
  using (
    (owner_type = 'community' and owner_id in (
      select id from communities where owner_id = auth.uid()
    ))
    or
    (owner_type = 'expert' and owner_id in (
      select id from experts where profile_id = auth.uid()
    ))
  );

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –º–µ–¥–∏–∞
create or replace function count_media_for_owner(
  p_owner_type text,
  p_owner_id uuid
)
returns int as $$
  select count(*)::int
  from media_library
  where owner_type = p_owner_type
    and owner_id = p_owner_id;
$$ language sql stable;

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞
create or replace function check_media_limit()
returns trigger as $$
begin
  if (select count_media_for_owner(new.owner_type, new.owner_id)) >= 200 then
    raise exception 'Media library limit reached (200 items)';
  end if;
  return new;
end;
$$ language plpgsql;

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞
create trigger check_media_limit_trigger
  before insert on media_library
  for each row
  execute procedure check_media_limit();
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ communities
alter table communities 
  add column if not exists media_count int default 0;

-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ experts
alter table experts 
  add column if not exists media_count int default 0;

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
create or replace function update_media_count_on_insert()
returns trigger as $$
begin
  if new.owner_type = 'community' then
    update communities 
    set media_count = media_count + 1 
    where id = new.owner_id;
  elsif new.owner_type = 'expert' then
    update experts 
    set media_count = media_count + 1 
    where id = new.owner_id;
  end if;
  return new;
end;
$$ language plpgsql;

create trigger media_count_insert_trigger
  after insert on media_library
  for each row
  execute procedure update_media_count_on_insert();

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
create or replace function update_media_count_on_delete()
returns trigger as $$
begin
  if old.owner_type = 'community' then
    update communities 
    set media_count = media_count - 1 
    where id = old.owner_id;
  elsif old.owner_type = 'expert' then
    update experts 
    set media_count = media_count - 1 
    where id = old.owner_id;
  end if;
  return old;
end;
$$ language plpgsql;

create trigger media_count_delete_trigger
  after delete on media_library
  for each row
  execute procedure update_media_count_on_delete();
```

---

## üì¶ –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Supabase Storage

```
Buckets:
‚îú‚îÄ‚îÄ media-library/
‚îÇ   ‚îú‚îÄ‚îÄ communities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ {community_id}/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ large/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {uuid}.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ medium/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {uuid}.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ thumbnails/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ {uuid}.webp
‚îÇ   ‚îî‚îÄ‚îÄ experts/
‚îÇ       ‚îú‚îÄ‚îÄ {expert_id}/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ large/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {uuid}.webp
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ medium/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {uuid}.webp
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ thumbnails/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ {uuid}.webp
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Storage Bucket

```typescript
// –°–æ–∑–¥–∞—Ç—å bucket –≤ Supabase Dashboard –∏–ª–∏ —á–µ—Ä–µ–∑ SQL
insert into storage.buckets (id, name, public)
values ('media-library', 'media-library', true);

// –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
create policy "Public read access"
  on storage.objects for select
  using (bucket_id = 'media-library');

create policy "Authenticated users can upload"
  on storage.objects for insert
  with check (
    bucket_id = 'media-library' 
    and auth.role() = 'authenticated'
  );

create policy "Users can delete own media"
  on storage.objects for delete
  using (
    bucket_id = 'media-library'
    and auth.uid()::text = (storage.foldername(name))[1]
  );
```

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

```typescript
// –§–æ—Ä–º–∞—Ç: {uuid}.webp
// –ü—Ä–∏–º–µ—Ä: 
// large/a1b2c3d4-e5f6-7890-abcd-ef1234567890.webp
// medium/a1b2c3d4-e5f6-7890-abcd-ef1234567890.webp
// thumbnails/a1b2c3d4-e5f6-7890-abcd-ef1234567890.webp
```

---

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**–í–∞—Ä–∏–∞–Ω—Ç 1: Browser-side (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)**
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `browser-image-compression`
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä, –±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ—â–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–∞—Ä–∏–∞–Ω—Ç 2: Server-side (–¥–ª—è production)**
- Edge Function —Å `sharp` –∏–ª–∏ `imageMagick`
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Edge Functions

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ (Browser-side)

```typescript
// lib/utils/image-processing.ts
import imageCompression from 'browser-image-compression';

export interface ProcessedImage {
  large: File;
  medium: File;
  thumbnail: File;
  shouldDeleteOriginal: boolean;
}

export async function processImage(file: File): Promise<ProcessedImage> {
  const originalSizeMB = file.size / 1024 / 1024;
  
  // –û–ø—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
  const largeOptions = {
    maxSizeMB: 2,
    maxWidthOrHeight: 1920,
    useWebWorker: true,
    fileType: 'image/webp',
  };
  
  const mediumOptions = {
    maxSizeMB: 0.5,
    maxWidthOrHeight: 800,
    useWebWorker: true,
    fileType: 'image/webp',
  };
  
  const thumbnailOptions = {
    maxSizeMB: 0.1,
    maxWidthOrHeight: 300,
    useWebWorker: true,
    fileType: 'image/webp',
  };
  
  // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
  const [large, medium, thumbnail] = await Promise.all([
    imageCompression(file, largeOptions),
    imageCompression(file, mediumOptions),
    imageCompression(file, thumbnailOptions),
  ]);
  
  return {
    large,
    medium,
    thumbnail,
    shouldDeleteOriginal: originalSizeMB > 3,
  };
}

// –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
export async function getImageDimensions(file: File): Promise<{ width: number; height: number }> {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => {
      resolve({ width: img.width, height: img.height });
    };
    img.onerror = reject;
    img.src = URL.createObjectURL(file);
  });
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
export function validateImageFile(file: File): { valid: boolean; error?: string } {
  const maxSize = 10 * 1024 * 1024; // 10MB
  const allowedTypes = ['image/jpeg', 'image/png', 'image/webp'];
  
  if (!allowedTypes.includes(file.type)) {
    return { valid: false, error: '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JPG, PNG –∏–ª–∏ WebP' };
  }
  
  if (file.size > maxSize) {
    return { valid: false, error: '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º 10MB' };
  }
  
  return { valid: true };
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ (Server-side Edge Function)

```typescript
// supabase/functions/process-image/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
import { Image } from 'https://deno.land/x/imagescript@1.2.15/mod.ts';

serve(async (req) => {
  try {
    const { imageUrl, sizes } = await req.json();
    
    // –°–∫–∞—á–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª
    const response = await fetch(imageUrl);
    const arrayBuffer = await response.arrayBuffer();
    const image = await Image.decode(new Uint8Array(arrayBuffer));
    
    const results = {};
    
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑–º–µ—Ä
    for (const [name, maxSize] of Object.entries(sizes)) {
      const resized = image.resize(maxSize, Image.RESIZE_AUTO);
      const encoded = await resized.encodeWebP(85); // –∫–∞—á–µ—Å—Ç–≤–æ 85%
      results[name] = encoded;
    }
    
    return new Response(JSON.stringify(results), {
      headers: { 'Content-Type': 'application/json' },
    });
  } catch (error) {
    return new Response(JSON.stringify({ error: error.message }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' },
    });
  }
});
```

---

## üé® UI/UX –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ (MediaUploader)

```typescript
// components/media/MediaUploader.tsx
'use client';

import { useState, useCallback } from 'react';
import { useDropzone } from 'react-dropzone';
import { processImage, validateImageFile } from '@/lib/utils/image-processing';
import { uploadMediaToLibrary } from '@/app/actions/media';

interface MediaUploaderProps {
  ownerType: 'community' | 'expert';
  ownerId: string;
  currentCount: number;
  maxCount?: number;
  onUploadComplete?: () => void;
}

export function MediaUploader({
  ownerType,
  ownerId,
  currentCount,
  maxCount = 200,
  onUploadComplete,
}: MediaUploaderProps) {
  const [uploading, setUploading] = useState(false);
  const [progress, setProgress] = useState<Record<string, number>>({});
  const [errors, setErrors] = useState<string[]>([]);

  const onDrop = useCallback(async (acceptedFiles: File[]) => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
    if (currentCount + acceptedFiles.length > maxCount) {
      setErrors([`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç. –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ ${maxCount - currentCount} —Ñ–æ—Ç–æ`]);
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑
    if (acceptedFiles.length > 10) {
      setErrors(['–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞–∫—Å–∏–º—É–º 10 —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑']);
      return;
    }

    setUploading(true);
    setErrors([]);
    const newProgress: Record<string, number> = {};

    for (const file of acceptedFiles) {
      try {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        const validation = validateImageFile(file);
        if (!validation.valid) {
          setErrors(prev => [...prev, `${file.name}: ${validation.error}`]);
          continue;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        newProgress[file.name] = 10;
        setProgress({ ...newProgress });

        const processed = await processImage(file);
        
        newProgress[file.name] = 50;
        setProgress({ ...newProgress });

        // –ó–∞–≥—Ä—É–∑–∫–∞
        await uploadMediaToLibrary({
          ownerType,
          ownerId,
          files: processed,
          metadata: {
            originalFilename: file.name,
            mimeType: file.type,
          },
        });

        newProgress[file.name] = 100;
        setProgress({ ...newProgress });

      } catch (error) {
        setErrors(prev => [...prev, `${file.name}: ${error.message}`]);
      }
    }

    setUploading(false);
    onUploadComplete?.();
  }, [ownerType, ownerId, currentCount, maxCount, onUploadComplete]);

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    accept: {
      'image/jpeg': ['.jpg', '.jpeg'],
      'image/png': ['.png'],
      'image/webp': ['.webp'],
    },
    maxFiles: 10,
    disabled: uploading || currentCount >= maxCount,
  });

  return (
    <div className="space-y-4">
      {/* Dropzone */}
      <div
        {...getRootProps()}
        className={`
          border-2 border-dashed rounded-xl p-12 text-center cursor-pointer
          transition-all duration-200
          ${isDragActive 
            ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' 
            : 'border-gray-300 dark:border-neutral-600 hover:border-blue-400'
          }
          ${uploading ? 'opacity-50 cursor-not-allowed' : ''}
        `}
      >
        <input {...getInputProps()} />
        
        <div className="flex flex-col items-center gap-4">
          <svg className="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
          
          <div>
            <p className="text-lg font-medium text-gray-900 dark:text-white">
              {isDragActive ? '–û—Ç–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –∑–¥–µ—Å—å' : '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞'}
            </p>
            <p className="text-sm text-gray-500 dark:text-neutral-400 mt-1">
              –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
            </p>
            <p className="text-xs text-gray-400 dark:text-neutral-500 mt-2">
              JPG, PNG, WebP –¥–æ 10MB ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 10 —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑
            </p>
          </div>
          
          <div className="text-sm text-gray-600 dark:text-neutral-400">
            –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {currentCount} / {maxCount}
          </div>
        </div>
      </div>

      {/* Progress */}
      {uploading && Object.keys(progress).length > 0 && (
        <div className="space-y-2">
          <p className="text-sm font-medium text-gray-700 dark:text-neutral-300">
            –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...
          </p>
          {Object.entries(progress).map(([filename, percent]) => (
            <div key={filename} className="space-y-1">
              <div className="flex justify-between text-xs text-gray-600 dark:text-neutral-400">
                <span className="truncate max-w-xs">{filename}</span>
                <span>{percent}%</span>
              </div>
              <div className="w-full bg-gray-200 dark:bg-neutral-700 rounded-full h-2">
                <div
                  className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                  style={{ width: `${percent}%` }}
                />
              </div>
            </div>
          ))}
        </div>
      )}

      {/* Errors */}
      {errors.length > 0 && (
        <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
          <p className="text-sm font-medium text-red-800 dark:text-red-300 mb-2">
            –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:
          </p>
          <ul className="text-sm text-red-700 dark:text-red-400 space-y-1">
            {errors.map((error, i) => (
              <li key={i}>‚Ä¢ {error}</li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
}
```

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (MediaLibrary)

```typescript
// components/media/MediaLibrary.tsx
'use client';

import { useState, useEffect } from 'react';
import { MediaUploader } from './MediaUploader';
import { MediaGrid } from './MediaGrid';
import { getMediaLibrary, updateMediaItem, deleteMediaItem } from '@/app/actions/media';

interface MediaLibraryProps {
  ownerType: 'community' | 'expert';
  ownerId: string;
}

export function MediaLibrary({ ownerType, ownerId }: MediaLibraryProps) {
  const [media, setMedia] = useState([]);
  const [loading, setLoading] = useState(true);
  const [view, setView] = useState<'grid' | 'upload'>('grid');

  const loadMedia = async () => {
    setLoading(true);
    const data = await getMediaLibrary(ownerType, ownerId);
    setMedia(data);
    setLoading(false);
  };

  useEffect(() => {
    loadMedia();
  }, [ownerType, ownerId]);

  const handleTogglePublish = async (id: string, isPublished: boolean) => {
    await updateMediaItem(id, { is_published: !isPublished });
    await loadMedia();
  };

  const handleDelete = async (id: string) => {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) {
      await deleteMediaItem(id);
      await loadMedia();
    }
  };

  const handleUpdateOrder = async (items: Array<{ id: string; order: number }>) => {
    await Promise.all(
      items.map(item => updateMediaItem(item.id, { display_order: item.order }))
    );
    await loadMedia();
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold text-gray-900 dark:text-white">
            –ú–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∞
          </h2>
          <p className="text-gray-600 dark:text-neutral-400 mt-1">
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –¥–ª—è –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          </p>
        </div>
        
        <div className="flex gap-2">
          <button
            onClick={() => setView('grid')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              view === 'grid'
                ? 'bg-blue-600 text-white'
                : 'bg-gray-200 dark:bg-neutral-700 text-gray-700 dark:text-neutral-300'
            }`}
          >
            üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
          </button>
          <button
            onClick={() => setView('upload')}
            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
              view === 'upload'
                ? 'bg-blue-600 text-white'
                : 'bg-gray-200 dark:bg-neutral-700 text-gray-700 dark:text-neutral-300'
            }`}
          >
            ‚¨ÜÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å
          </button>
        </div>
      </div>

      {/* Content */}
      {view === 'upload' ? (
        <MediaUploader
          ownerType={ownerType}
          ownerId={ownerId}
          currentCount={media.length}
          onUploadComplete={() => {
            loadMedia();
            setView('grid');
          }}
        />
      ) : (
        <MediaGrid
          media={media}
          loading={loading}
          onTogglePublish={handleTogglePublish}
          onDelete={handleDelete}
          onUpdateOrder={handleUpdateOrder}
        />
      )}
    </div>
  );
}
```

### 3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–µ—Ç–∫–∏ –º–µ–¥–∏–∞ (MediaGrid)

```typescript
// components/media/MediaGrid.tsx
'use client';

import { useState } from 'react';
import { DndContext, closestCenter, DragEndEvent } from '@dnd-kit/core';
import { arrayMove, SortableContext, rectSortingStrategy } from '@dnd-kit/sortable';
import { MediaGridItem } from './MediaGridItem';

interface MediaItem {
  id: string;
  url_thumbnail: string;
  url_medium: string;
  url_large: string;
  title?: string;
  is_published: boolean;
  display_order: number;
}

interface MediaGridProps {
  media: MediaItem[];
  loading: boolean;
  onTogglePublish: (id: string, isPublished: boolean) => void;
  onDelete: (id: string) => void;
  onUpdateOrder: (items: Array<{ id: string; order: number }>) => void;
}

export function MediaGrid({
  media,
  loading,
  onTogglePublish,
  onDelete,
  onUpdateOrder,
}: MediaGridProps) {
  const [items, setItems] = useState(media);
  const [selectedImage, setSelectedImage] = useState<MediaItem | null>(null);

  useEffect(() => {
    setItems(media.sort((a, b) => a.display_order - b.display_order));
  }, [media]);

  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;
    
    if (over && active.id !== over.id) {
      const oldIndex = items.findIndex(item => item.id === active.id);
      const newIndex = items.findIndex(item => item.id === over.id);
      
      const newItems = arrayMove(items, oldIndex, newIndex);
      setItems(newItems);
      
      // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
      onUpdateOrder(
        newItems.map((item, index) => ({ id: item.id, order: index }))
      );
    }
  };

  if (loading) {
    return (
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {[...Array(8)].map((_, i) => (
          <div key={i} className="aspect-square bg-gray-200 dark:bg-neutral-700 rounded-lg animate-pulse" />
        ))}
      </div>
    );
  }

  if (items.length === 0) {
    return (
      <div className="text-center py-12 bg-gray-50 dark:bg-neutral-800 rounded-xl">
        <svg className="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p className="text-gray-600 dark:text-neutral-400">
          –ú–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞
        </p>
        <p className="text-sm text-gray-500 dark:text-neutral-500 mt-1">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–≤—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        </p>
      </div>
    );
  }

  return (
    <>
      <DndContext collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
        <SortableContext items={items.map(i => i.id)} strategy={rectSortingStrategy}>
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {items.map(item => (
              <MediaGridItem
                key={item.id}
                item={item}
                onTogglePublish={() => onTogglePublish(item.id, item.is_published)}
                onDelete={() => onDelete(item.id)}
                onView={() => setSelectedImage(item)}
              />
            ))}
          </div>
        </SortableContext>
      </DndContext>

      {/* Lightbox –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */}
      {selectedImage && (
        <div
          className="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4"
          onClick={() => setSelectedImage(null)}
        >
          <img
            src={selectedImage.url_large}
            alt={selectedImage.title || ''}
            className="max-w-full max-h-full object-contain"
          />
          <button
            onClick={() => setSelectedImage(null)}
            className="absolute top-4 right-4 text-white hover:text-gray-300"
          >
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      )}
    </>
  );
}
```

### 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–µ—Ç–∫–∏ (MediaGridItem)

```typescript
// components/media/MediaGridItem.tsx
'use client';

import { useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';

interface MediaGridItemProps {
  item: {
    id: string;
    url_thumbnail: string;
    title?: string;
    is_published: boolean;
  };
  onTogglePublish: () => void;
  onDelete: () => void;
  onView: () => void;
}

export function MediaGridItem({
  item,
  onTogglePublish,
  onDelete,
  onView,
}: MediaGridItemProps) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: item.id });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging ? 0.5 : 1,
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      className="group relative aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-neutral-800"
    >
      {/* Image */}
      <img
        src={item.url_thumbnail}
        alt={item.title || ''}
        className="w-full h-full object-cover"
      />

      {/* Overlay */}
      <div className="absolute inset-0 bg-black/0 group-hover:bg-black/50 transition-all duration-200">
        <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
          <div className="flex gap-2">
            <button
              onClick={onView}
              className="p-2 bg-white rounded-lg hover:bg-gray-100 transition-colors"
              title="–ü—Ä–æ—Å–º–æ—Ç—Ä"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
            </button>
            <button
              onClick={onDelete}
              className="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
              title="–£–¥–∞–ª–∏—Ç—å"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>
      </div>

      {/* Drag Handle */}
      <div
        {...attributes}
        {...listeners}
        className="absolute top-2 left-2 p-1 bg-white/80 rounded cursor-move opacity-0 group-hover:opacity-100 transition-opacity"
      >
        <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8h16M4 16h16" />
        </svg>
      </div>

      {/* Published Badge */}
      <button
        onClick={onTogglePublish}
        className={`absolute top-2 right-2 px-2 py-1 rounded text-xs font-medium transition-all ${
          item.is_published
            ? 'bg-green-500 text-white'
            : 'bg-gray-500/80 text-white opacity-0 group-hover:opacity-100'
        }`}
      >
        {item.is_published ? '‚úì –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ' : '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'}
      </button>
    </div>
  );
}
```

### 5. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—É—Å–µ–ª–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (MediaCarousel)

```typescript
// components/media/MediaCarousel.tsx
'use client';

import { useState } from 'react';
import { Swiper, SwiperSlide } from 'swiper/react';
import { Navigation, Pagination, Autoplay } from 'swiper/modules';
import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';

interface MediaCarouselProps {
  media: Array<{
    id: string;
    url_medium: string;
    url_large: string;
    title?: string;
    description?: string;
  }>;
  autoplay?: boolean;
}

export function MediaCarousel({ media, autoplay = true }: MediaCarouselProps) {
  const [selectedImage, setSelectedImage] = useState<string | null>(null);

  if (!media || media.length === 0) {
    return null;
  }

  return (
    <>
      <div className="relative rounded-xl overflow-hidden">
        <Swiper
          modules={[Navigation, Pagination, Autoplay]}
          spaceBetween={0}
          slidesPerView={1}
          navigation
          pagination={{ clickable: true }}
          autoplay={autoplay ? { delay: 5000, disableOnInteraction: false } : false}
          className="aspect-video"
        >
          {media.map(item => (
            <SwiperSlide key={item.id}>
              <div
                className="relative w-full h-full cursor-pointer"
                onClick={() => setSelectedImage(item.url_large)}
              >
                <img
                  src={item.url_medium}
                  alt={item.title || ''}
                  className="w-full h-full object-cover"
                />
                {item.title && (
                  <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6">
                    <h3 className="text-white text-xl font-semibold">
                      {item.title}
                    </h3>
                    {item.description && (
                      <p className="text-white/90 text-sm mt-1">
                        {item.description}
                      </p>
                    )}
                  </div>
                )}
              </div>
            </SwiperSlide>
          ))}
        </Swiper>
      </div>

      {/* Lightbox */}
      {selectedImage && (
        <div
          className="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4"
          onClick={() => setSelectedImage(null)}
        >
          <img
            src={selectedImage}
            alt=""
            className="max-w-full max-h-full object-contain"
          />
          <button
            onClick={() => setSelectedImage(null)}
            className="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors"
          >
            <svg className="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      )}
    </>
  );
}
```

---

## üîå API –∏ Server Actions

### Server Actions –¥–ª—è –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```typescript
// app/actions/media.ts
'use server';

import { revalidatePath } from 'next/cache';
import { createSupabaseServerClient } from '@/lib/supabase/client';
import { v4 as uuidv4 } from 'uuid';

interface UploadMediaParams {
  ownerType: 'community' | 'expert';
  ownerId: string;
  files: {
    large: File;
    medium: File;
    thumbnail: File;
  };
  metadata: {
    originalFilename: string;
    mimeType: string;
    title?: string;
    description?: string;
  };
}

export async function uploadMediaToLibrary(params: UploadMediaParams) {
  const supabase = createSupabaseServerClient();
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) throw new Error('Unauthorized');

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  const hasAccess = await checkMediaAccess(params.ownerType, params.ownerId, user.id);
  if (!hasAccess) throw new Error('Access denied');

  const mediaId = uuidv4();
  const basePath = `${params.ownerType}s/${params.ownerId}`;

  try {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
    const [largeUpload, mediumUpload, thumbnailUpload] = await Promise.all([
      supabase.storage
        .from('media-library')
        .upload(`${basePath}/large/${mediaId}.webp`, params.files.large, {
          contentType: 'image/webp',
          cacheControl: '31536000',
        }),
      supabase.storage
        .from('media-library')
        .upload(`${basePath}/medium/${mediaId}.webp`, params.files.medium, {
          contentType: 'image/webp',
          cacheControl: '31536000',
        }),
      supabase.storage
        .from('media-library')
        .upload(`${basePath}/thumbnails/${mediaId}.webp`, params.files.thumbnail, {
          contentType: 'image/webp',
          cacheControl: '31536000',
        }),
    ]);

    if (largeUpload.error || mediumUpload.error || thumbnailUpload.error) {
      throw new Error('Upload failed');
    }

    // –ü–æ–ª—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ URLs
    const { data: largeUrl } = supabase.storage
      .from('media-library')
      .getPublicUrl(largeUpload.data.path);
    const { data: mediumUrl } = supabase.storage
      .from('media-library')
      .getPublicUrl(mediumUpload.data.path);
    const { data: thumbnailUrl } = supabase.storage
      .from('media-library')
      .getPublicUrl(thumbnailUpload.data.path);

    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
    const { data, error } = await supabase
      .from('media_library')
      .insert({
        id: mediaId,
        owner_type: params.ownerType,
        owner_id: params.ownerId,
        title: params.metadata.title,
        description: params.metadata.description,
        url_large: largeUrl.publicUrl,
        url_medium: mediumUrl.publicUrl,
        url_thumbnail: thumbnailUrl.publicUrl,
        storage_path_large: largeUpload.data.path,
        storage_path_medium: mediumUpload.data.path,
        storage_path_thumbnail: thumbnailUpload.data.path,
        original_filename: params.metadata.originalFilename,
        file_size_bytes: params.files.large.size,
        mime_type: params.metadata.mimeType,
      })
      .select()
      .single();

    if (error) throw error;

    revalidatePath(`/dashboard/${params.ownerType}/media`);
    return data;
  } catch (error) {
    // –û—Ç–∫–∞—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
    await Promise.all([
      supabase.storage.from('media-library').remove([`${basePath}/large/${mediaId}.webp`]),
      supabase.storage.from('media-library').remove([`${basePath}/medium/${mediaId}.webp`]),
      supabase.storage.from('media-library').remove([`${basePath}/thumbnails/${mediaId}.webp`]),
    ]);
    throw error;
  }
}

export async function getMediaLibrary(ownerType: string, ownerId: string) {
  const supabase = createSupabaseServerClient();
  
  const { data, error } = await supabase
    .from('media_library')
    .select('*')
    .eq('owner_type', ownerType)
    .eq('owner_id', ownerId)
    .order('display_order', { ascending: true });

  if (error) throw error;
  return data;
}

export async function getPublishedMedia(ownerType: string, ownerId: string) {
  const supabase = createSupabaseServerClient();
  
  const { data, error } = await supabase
    .from('media_library')
    .select('*')
    .eq('owner_type', ownerType)
    .eq('owner_id', ownerId)
    .eq('is_published', true)
    .order('display_order', { ascending: true });

  if (error) throw error;
  return data;
}

export async function updateMediaItem(id: string, updates: Partial<MediaItem>) {
  const supabase = createSupabaseServerClient();
  
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) throw new Error('Unauthorized');

  const { data, error } = await supabase
    .from('media_library')
    .update(updates)
    .eq('id', id)
    .select()
    .single();

  if (error) throw error;

  revalidatePath('/dashboard');
  return data;
}

export async function deleteMediaItem(id: string) {
  const supabase = createSupabaseServerClient();
  
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) throw new Error('Unauthorized');

  // –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç–∏ —Ñ–∞–π–ª–æ–≤
  const { data: media } = await supabase
    .from('media_library')
    .select('storage_path_large, storage_path_medium, storage_path_thumbnail')
    .eq('id', id)
    .single();

  if (!media) throw new Error('Media not found');

  // –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ Storage
  await Promise.all([
    supabase.storage.from('media-library').remove([media.storage_path_large]),
    supabase.storage.from('media-library').remove([media.storage_path_medium]),
    supabase.storage.from('media-library').remove([media.storage_path_thumbnail]),
  ]);

  // –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ –ë–î
  const { error } = await supabase
    .from('media_library')
    .delete()
    .eq('id', id);

  if (error) throw error;

  revalidatePath('/dashboard');
}

async function checkMediaAccess(
  ownerType: string,
  ownerId: string,
  userId: string
): Promise<boolean> {
  const supabase = createSupabaseServerClient();

  if (ownerType === 'community') {
    const { data } = await supabase
      .from('communities')
      .select('owner_id')
      .eq('id', ownerId)
      .single();
    return data?.owner_id === userId;
  } else if (ownerType === 'expert') {
    const { data } = await supabase
      .from('experts')
      .select('profile_id')
      .eq('id', ownerId)
      .single();
    return data?.profile_id === userId;
  }

  return false;
}
```

---

## üîÑ Workflow –∑–∞–≥—Ä—É–∑–∫–∏

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª—ã] --> B{–í–∞–ª–∏–¥–∞—Ü–∏—è}
    B -->|–û—à–∏–±–∫–∞| C[–ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É]
    B -->|OK| D[–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π]
    D --> E[–°–æ–∑–¥–∞–Ω–∏–µ Large 1920px]
    D --> F[–°–æ–∑–¥–∞–Ω–∏–µ Medium 800px]
    D --> G[–°–æ–∑–¥–∞–Ω–∏–µ Thumbnail 300px]
    E --> H{–†–∞–∑–º–µ—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ > 3MB?}
    H -->|–î–∞| I[–ü–æ–º–µ—Ç–∏—Ç—å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è]
    H -->|–ù–µ—Ç| J[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª]
    I --> K[–ó–∞–≥—Ä—É–∑–∫–∞ –≤ Supabase Storage]
    J --> K
    F --> K
    G --> K
    K --> L[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ –ë–î]
    L --> M[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞]
    M --> N[Revalidate —Å—Ç—Ä–∞–Ω–∏—Ü—ã]
    N --> O[–ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö]
```

---

## üìä Best Practices

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```typescript
<img
  src={item.url_thumbnail}
  loading="lazy"
  decoding="async"
  alt={item.title}
/>
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ WebP:**
- –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ (~30% —ç–∫–æ–Ω–æ–º–∏–∏)
- –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∏ —Ç–æ–º –∂–µ —Ä–∞–∑–º–µ—Ä–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ–º–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏

**CDN –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```typescript
// Supabase Storage –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CDN
// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
cacheControl: '31536000' // 1 –≥–æ–¥
```

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ò —Å–µ—Ä–≤–µ—Ä–µ:**
```typescript
// –ö–ª–∏–µ–Ω—Ç
const validation = validateImageFile(file);

// –°–µ—Ä–≤–µ—Ä
if (!allowedMimeTypes.includes(file.type)) {
  throw new Error('Invalid file type');
}
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:**
```typescript
// –í Supabase Storage bucket settings
max_file_size: 10485760 // 10MB
```

**–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UUID –≤–º–µ—Å—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω
const filename = `${uuidv4()}.webp`;
```

### 3. UX

**–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å:**
```typescript
// –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
setProgress({ [filename]: percent });
```

**–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π:**
```typescript
const reader = new FileReader();
reader.onloadend = () => {
  setPreview(reader.result);
};
reader.readAsDataURL(file);
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```typescript
try {
  await uploadMedia();
} catch (error) {
  setErrors(prev => [...prev, error.message]);
}
```

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
```typescript
const [large, medium, thumbnail] = await Promise.all([
  processLarge(file),
  processMedium(file),
  processThumbnail(file),
]);
```

**Batch –æ–ø–µ—Ä–∞—Ü–∏–∏:**
```typescript
// –ó–∞–≥—Ä—É–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
await Promise.all(files.map(file => uploadFile(file)));
```

**–ò–Ω–¥–µ–∫—Å—ã –ë–î:**
```sql
create index media_library_owner_idx 
  on media_library(owner_type, owner_id);
```

---

## üì¶ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

```json
{
  "dependencies": {
    "browser-image-compression": "^2.0.2",
    "react-dropzone": "^14.2.3",
    "swiper": "^12.0.3",
    "@dnd-kit/core": "^6.1.0",
    "@dnd-kit/sortable": "^8.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "uuid": "^9.0.1"
  },
  "devDependencies": {
    "@types/uuid": "^9.0.7"
  }
}
```

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

1. **–§–∞–∑–∞ 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (1 –¥–µ–Ω—å)
   - –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É [`media_library`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0)
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
   - –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏

2. **–§–∞–∑–∞ 2: Storage** (1 –¥–µ–Ω—å)
   - –°–æ–∑–¥–∞—Ç—å bucket –≤ Supabase
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É

3. **–§–∞–∑–∞ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (2 –¥–Ω—è)
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∂–∞—Ç–∏—è
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

4. **–§–∞–∑–∞ 4: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (3 –¥–Ω—è)
   - [`MediaUploader`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0) —Å drag & drop
   - [`MediaLibrary`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0) —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
   - [`MediaCarousel`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0) –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

5. **–§–∞–∑–∞ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (2 –¥–Ω—è)
   - –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É —Å–æ–æ–±—â–µ—Å—Ç–≤
   - –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—É—Å–µ–ª–∏ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

6. **–§–∞–∑–∞ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (2 –¥–Ω—è)
   - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤

**–û–±—â–µ–µ –≤—Ä–µ–º—è: ~11 –¥–Ω–µ–π**

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç

- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É [`media_library`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase Storage bucket
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç [`MediaUploader`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0)
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç [`MediaLibrary`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0)
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç [`MediaCarousel`](cci:1://file:///t:/DEV/amvera/afisha_genspark/docs/MEDIA_LIBRARY_ARCHITECTURE.md:0:0-0:0)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Server Actions
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É —Å–æ–æ–±—â–µ—Å—Ç–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—É—Å–µ–ª–∏ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

**–ì–æ—Ç–æ–≤–æ! –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–µ–¥–∏–∞–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞! üéâ**